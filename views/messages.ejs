
<%- include('inputDialog.ejs') %>



<!-- Messagees Content -->
<main id="wrapper"
    class="  bg-blm z-0  fixed top-0 bottom-0 left-0 right-0  flex flex-col justify-between items-center transition-colors duration-500 ease-in-out ">
    <nav class="px-6 py-5 pt-5 space-y-4  w-full ">
        <div class="flex justify-between items-center">
        <h1 class="font-[600] text-blf text-2xl">Wassup</h1>
<a href="/profile" class="flex justify-center bg-blh  rounded-full aspect-square items-center text-center min-h-9 h-9 overflow-hidden ">
   <img class="aspect-square h-8 min-h-8 rounded-full " src="/img/<%= myPic %>" alt="">
</a>

        </div>
        <div class="flex justify-between  items-center gap-2 text-black">
            <div class="flex justify-start items-center gap-4 border w-10/12 bg-blh rounded-md px-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                    class="w-6 text-blt">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                <input placeholder="Search Messages..." type="text"
                    class="w-8/12 bg-transparent outline-none  text-blt placeholder:text-blt  py-1">
        
            </div>
           <a  id="navBtn" class="cursor-pointer">
            <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-7 text-black">
                <path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75H12a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
              </svg>
            </a>
        </div>

        <div class="flex justify-center items-start h-8">
            <div class="w-1/2 flex flex-col  items-center justify-start h-full">
                <button class="h-full text-black ">Messages</button>
                <div class="w-full  bg-blh h-1 rounded-full"></div>
            </div>
            <div class="w-1/2 flex flex-col  items-center justify-start h-full">
                <button class="h-full ">Requests</button>
                <div class="w-full  h-1 rounded-full"></div>

            </div>
        </div>
    </nav>

    <!-- List of people with whom  user doing chat -->
    <% if (friendData.length > 0) { %>
    <div
        class=" bg-blm flex flex-col space-y-3 px-4 fixed top-40 bottom-24 py-2 left-0 right-0 overflow-y-scroll">
        <% friendData.forEach(friend => { %>
        <% if (friend.state == "connected") { %>
        <div id="<%= friend.chatId %>"
            class="bg-blh border border-blb rounded-xl messageId flex justify-between items-center px-4 py-4 relative ">
            <div class="flex justify-center gap-2">
                <img class="profilePic w-12 h-12 rounded-full"
                    src="/img/<%= friend.profilePic %>"
                    alt="" />
                <div class="flex flex-col items-start justify-center gap-0.5">
                    <h1 class="name text-sm text-black font-semibold">
                        <%= friend.name %>
                    </h1>
                    <div
                        class=" lastText overflow-hidden whitespace-nowrap text-blt text-ellipsis max-w-36 w-36 text-xs ">
                        Would you support me when nobody will come to save me ,
                        Krishna
                    </div>
                </div>
            </div>
            <div class="flex flex-col items-center justify-center gap-0.5">
                <p class="text-xs text-blt font-semibold">12:14</p>
                <div
                    class="bg-blf  rounded-full w-5 h-5 text-center flex items-center justify-center">
                    <p class="text-xs text-white font-sans font-semibold">2</p>
                </div>
            </div>
            <div class="absolute bottom-0 w-4/5  right-1 rounded-full"></div>
        </div>

        
        <% } %>
        
        <% })
} %>
    </div>


    <!-- Plus Anything, aboslute with above div  -->

    <a href="/messages" id="plsBt"
        class="absolute bottom-28 shadow-md  text-blm right-5   bg-blf  text-center flex flex-col justify-center items-center rounded-full h-14 w-14 ">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
    
    </a>
    
    <footer class="">
        <div
            class="fixed bottom-6 left-3 right-3  px-6 h-16 text-center  flex justify-around items-center bg-blm border-2 border-blb  py-4 rounded-full ">
            <a id="msgBt" href=""
                class="footAnc flex flex-col items-center justify-center w-1/3">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    fill="currentColor" class="w-6 h-6 text-blf">
                    <path fill-rule="evenodd"
                        d="M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.322 0 9.75-3.97 9.75-9 0-5.03-4.428-9-9.75-9s-9.75 3.97-9.75 9c0 2.409 1.025 4.587 2.674 6.192.232.226.277.428.254.543a3.73 3.73 0 0 1-.814 1.686.75.75 0 0 0 .44 1.223ZM8.25 10.875a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25ZM10.875 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875-1.125a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Z"
                        clip-rule="evenodd" />
                </svg>
                <p class="text-[8px] text-blf ">Messages</p>
            </a>
            <div class="bg-blb w-[1px] h-full"></div>
            <a id="quoteBt" href=""
                class="footAnc flex flex-col items-center justify-center w-1/3">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    fill="currentColor" class="w-6 h-6 text-black ">
                    <path fill-rule="evenodd"
                        d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z"
                        clip-rule="evenodd" />
                    <path fill-rule="evenodd"
                        d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z"
                        clip-rule="evenodd" />
                </svg>
                <p class="text-[8px] text-black ">Quotes</p>
            </a>
            <div class="bg-blb w-[1px] h-full"></div>
            <button id="moreBt" type="button"
                class="flex flex-col items-center justify-center w-1/3">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-black">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                  </svg>
                  
                  
                <p class="text-[8px] text-black">Profile</p>
            </button>
        </div>
    </footer>
</main>
<%- include('navM') %>
<%- include('blurBox.ejs') %>
<%- include('loader.ejs') %>
<%- include('warningBox.ejs') %>



<script>
// Variable defination
const wrapper = document.getElementById('wrapper')
    const plsBt = document.getElementById('plsBt');


// Clicking on Plus button 
    plsBt.addEventListener('click', (event) => {
        event.preventDefault();
        if (event.target.closest('#plsBt')) {
            uidInput();

        }
    });

    cancelBtn.addEventListener('click',(req,res)=>{
       cancelDailog();
        alert("hi")
            });


    viewProfileBtn.addEventListener('click',(event)=>{
           const uid = uidReturn();
           if(uid.length === 24){
           return window.location.href = `users/${uid}`;
           }


            });
  


   
   
    const messageIdBtn = document.querySelectorAll('.messageId');
    messageIdBtn.forEach(btn => {
        btn.addEventListener('click', (event) => {
            if (event.target.closest('.messageId')) {
                const messageDiv = event.target.closest(
                    '.messageId');
                const rid = messageDiv.getAttribute('id');
                // getting person name 
                const userNameElement = messageDiv
                    .querySelector('.name');
              
                const name = userNameElement.textContent.trim();
                // getting image name 
                const profilePic = messageDiv.querySelector(
                    '.profilePic');
                let profilePicSrc = profilePic.src;
                profilePicSrc = profilePicSrc.split('/');
                const imageName = profilePicSrc[profilePicSrc
                    .length - 1];

                // create object to store in local Storage
                const localUser = {
                    name: name,
                    profilePic: imageName,
                    rid: rid
                }
                // setting data into local Storage
                setLocalData(localUser);
                alert('data set into localStorgae');
                const data = getLocalData()
                console.log(data);
                window.location.href = `/messages/${rid}`
            }
        })

    })
</script>
<script src="/js/localStorage.js"></script>