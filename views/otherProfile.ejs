<main id="othersProfile" class=" rounded-xl h-svh w-full   gap-3 py-4 flex flex-col items-center  bg-blm transition-all duration-700 ease-in-out">
  <nav class="px-5 py-4 space-y-4  w-full  z-10  ">
    <div class="flex  justify-between items-center">
    <h1 id="fstate" fstate="<%= fstate %>" mstate="<%= mstate %>" class="font-[500] text-black text-xl" >@<%= id %></h1>
   
  </div>
  </nav>
  <div class="flex flex-col  w-full  bg-red text-blh  justify-between rounded-lg px-5 py-4 ">
           <div class="flex flex-col gap-4 ">
            <div class="  text-blm flex flex-col  justify-between items-center  py-1 px-4 gap-3 rounded-md" >

              <div class="border-2 border-blt rounded-full  overflow-hidden">
              <img id="profilePic" src="/img/<%= profilePic %>" alt="" class=" h-32 w-32 rounded-full border-2 border-blm "> 
          
              </div>
                  <div class="  flex w-full items-center justify-center flex-col  ">
                    <h1 id="name" class= "font-[500]  text-black rounded-md   px-2 py-0.5"><%= name %></h1>
                    <p id="bio" class="text-sm text-blt  w-full max-w-72 text-center "><%= bio %></p>
                  </div>
            </div>
          <!-- Unique Id Section -->
        <div class="w-full flex flex-col gap-1 items-center justify-center">
          <div class="bg-blh border border-blb shadow-sm shadow-blb text-black rounded-md w-full flex items-center  justify-between px-6 py-3 ">
           
            <div class="flex  items-start gap-3 ">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6 ">
                <path fill-rule="evenodd" d="M12 3.75a6.715 6.715 0 0 0-3.722 1.118.75.75 0 1 1-.828-1.25 8.25 8.25 0 0 1 12.8 6.883c0 3.014-.574 5.897-1.62 8.543a.75.75 0 0 1-1.395-.551A21.69 21.69 0 0 0 18.75 10.5 6.75 6.75 0 0 0 12 3.75ZM6.157 5.739a.75.75 0 0 1 .21 1.04A6.715 6.715 0 0 0 5.25 10.5c0 1.613-.463 3.12-1.265 4.393a.75.75 0 0 1-1.27-.8A6.715 6.715 0 0 0 3.75 10.5c0-1.68.503-3.246 1.367-4.55a.75.75 0 0 1 1.04-.211ZM12 7.5a3 3 0 0 0-3 3c0 3.1-1.176 5.927-3.105 8.056a.75.75 0 1 1-1.112-1.008A10.459 10.459 0 0 0 7.5 10.5a4.5 4.5 0 1 1 9 0c0 .547-.022 1.09-.067 1.626a.75.75 0 0 1-1.495-.123c.041-.495.062-.996.062-1.503a3 3 0 0 0-3-3Zm0 2.25a.75.75 0 0 1 .75.75c0 3.908-1.424 7.485-3.781 10.238a.75.75 0 0 1-1.14-.975A14.19 14.19 0 0 0 11.25 10.5a.75.75 0 0 1 .75-.75Zm3.239 5.183a.75.75 0 0 1 .515.927 19.417 19.417 0 0 1-2.585 5.544.75.75 0 0 1-1.243-.84 17.915 17.915 0 0 0 2.386-5.116.75.75 0 0 1 .927-.515Z" clip-rule="evenodd" />
              </svg>
            <div class="flex  flex-col items-start gap-1">
            <h1  class=" text-xs">Username</h1>
              <h1 id="uid" class="text-xs"><%= id %></h1>
            </div>
            </div>
            <button class="   text-blf justify-center flex items-center rounded-md">
              <p id="theirQuotes" class=" text-sm cursor-pointer rounded-md font-[600]  px-2 py-2  flex justify-between text-center items-center gap-1"> See Posts<span>
              </span></p>
            </button>
            </div>
           
        </div>
           
           </div>
        
         
<% if (fstate === 'unset') { %>

           <div class=" flex gap-2 items-center  justify-between  pt-3">
            <div id="" class="back flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-black bg-blh">
              <button  class="">Back</button>
              
            </div>
            <div id="requestBtn" class="flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-blm bg-blf">
                <button id="" class="">Send Request</button>
              </div>
              
        
          
            </div>
            <% } %>
            <% if (fstate === 'received') { %>
              <div  class=" flex gap-2 items-center  justify-between  pt-3">
               <div id="" class="back flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-black bg-blh">
                <button  class="">Back</button>
               </div>
               <div id="removeBtn" rid="<%= rid %>"  class="flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-blm bg-ble">
                   <button id="" class="">Remove</button>
                 </div>
               </div>
               <% } %>

               <% if (fstate === 'connected' && mstate === 'connected') { %>
                <div  class=" flex gap-2 items-center  justify-between  pt-3">
                 <div id="" class=" back flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-black bg-blh">
                  <button  class="back">Back</button>
                 </div>
                 <div id="message" rid="<%= rid %>"  class="flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-blm bg-blf">
                     <button  id="" class="">Message</button>
                   </div>
                 </div>
                 <% } %>

                 <% if (fstate === 'connected' && mstate === 'blocked') { %>
                  <div  class=" flex gap-2 items-center  justify-between  pt-3">
                   <div id="" class="back flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-black bg-blh">
                    <button >Back</button>
                   </div>
                   <div id="unblock" rid="<%= rid %>"   class="flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-blm bg-blf">
                       <button   class="">Unblock</button>
                     </div>
                   </div>
                   <% } %>



               <% if (fstate === 'sent') { %>
                <div  class=" flex gap-2 items-center  justify-between  pt-3">
                 <div id="acceptBtn" class="flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-blm bg-blf">
                   <button id="" class="">Accept</button>
                 </div>
                 <div rid="<%= rid %>" id="deleteBtn"  class="flex items-center justify-center gap-1 w-full py-1 px-2 rounded-md border border-blb text-blm bg-ble">
                     <button  id="" class="">Delete</button>
                   </div>
                 </div>
                 <% } %>
         
          </div>     
</main>
<%- include('./partials/blurBox.ejs') %>
<%- include('./partials/loader.ejs') %>
<%- include('./partials/warningBox.ejs') %>

<script>
const fstateContainer = document.getElementById('fstate');
const fstate =  fstateContainer.getAttribute('fstate');
const mstate =  fstateContainer.getAttribute('mstate');
const uid = document.getElementById('uid');
const theirQuotes = document.getElementById("theirQuotes");
const back = document.querySelectorAll('.back');
back.forEach(el=>{
  el.addEventListener('click',(event)=>{
    event.preventDefault();
    window.history.back();
  })
})
theirQuotes.addEventListener('click',(event)=>{
   event.preventDefault();
   window.location.href =  `/posts/${uid.innerText.trim()}`
  });


// case 1  fstate is unset
if (fstate === 'unset'){
  const sendRequest = document.getElementById('requestBtn');
  sendRequest.addEventListener('click',  (event) => {
    event.preventDefault(); // Prevent default form submission
    const id = uid.innerText.trim();
    // Assuming you have the data to send in a variable named 'content'
    
    fetch (`/requests/${id}`, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json; charset=UTF-8',
            'Accept': 'application/json'
        },
        
    }).then((data) => {
        
       return data.json();
    }).then((jsonData)=>{
if(jsonData.status === 'success'){
return successBox("Sent","Request has been sent successfully","/requests");
}
if(jsonData.message === 'YourSelf'){
  return fail("Fail","You can't send request to yourself","/messages");
}

if(jsonData.status === 'fail'){
  return fail("Fail","Please Enter a valid UID or Try Again","/messages");
}
if(jsonData.status === 'exists'){
  return fail("Already Sent","You have already sent the request to the user","/requests");
}

})
.catch(err => {
  return fail("Fail","Please Enter a valid UID or Try Again","/messages");
})
})
}

// case 2 fstate sent
if(fstate === 'received'){
  const removeBtn = document.getElementById('removeBtn');
  const rid = removeBtn.getAttribute('rid')
  removeBtn.addEventListener('click',(event)=>{

    fetch(`/requests/remove/${rid}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json; charset=UTF-8',
              'Accept': 'application/json'
            },
           
          }).then((data) => {
            
            return data.json();
          }).then((jsonData) => {

            if (jsonData.status === "success") {
              successBox("Removed Successfully","You have remove your request","/requests")
            }
          })
          .catch(err => {
            fail("Some Issue,Try again","We encountered some issue in removing your request","/requests")
           
          });
  })
}

// case 2 fstate sent
if(fstate === 'sent'){
  const acceptBtn = document.getElementById('acceptBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const rid = deleteBtn.getAttribute('rid')
  acceptBtn.addEventListener('click',(event)=>{

    fetch(`/requests/accept/${rid}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json; charset=UTF-8',
              'Accept': 'application/json'
            },
           
          }).then((data) => {
           
            return data.json();
          }).then((jsonData) => {

            if (jsonData.status === "success") {
              successBox("Accepted","You have accept the request","/messages")
              
            }
          })
          .catch(err => {
            fail("Some Issue,Try again","We encountered some issue in accepting the request","/requests")
            
          });
  })


  deleteBtn.addEventListener('click',(event)=>{
  fetch(`/requests/delete/${rid}`, {

method: 'DELETE',
headers: {
  'Content-Type': 'application/json; charset=UTF-8',
  'Accept': 'application/json'
},

}).then((data) => {

return data.json();
}).then((jsonData) => {

if (jsonData.status === "success") {
  successBox("Deleted","You have deleted the request","/requests")
  
}
})
.catch(err => {
fail("Some Issue,Try again","We encountered some issue in deleting the request","/requests")

});
})

}


if(fstate === 'connected' && mstate === 'connected'){
  message = document.getElementById('message');
 const rid = message.getAttribute('rid');
  message.addEventListener('click',(event)=>{
    event.preventDefault();
    window.location.href = `/messages/${rid}`
  })
}


if (fstate === 'connected' && mstate === 'blocked'){

  const unblock = document.getElementById('unblock');
  const rid = unblock.getAttribute('rid');
  unblock.addEventListener('click',(event)=>{
    event.preventDefault();
    unblockUserFun(rid);
  })

}





  
 
</script>